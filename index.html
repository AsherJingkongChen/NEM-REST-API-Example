<!DOCTYPE html>
<html class="hljs">
<head>
<meta charset="utf-8">
<meta
  name="description"
  content="CodeSlide makes a slideshow for code snippets">
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, user-scalable=no">
<link
  href="https://fonts.gstatic.com"
  rel="preconnect" crossorigin>
<style>
/*! Highlight.js Visual Studio 2015 Dark */
.hljs {
  background: #1e1e1e;
  color: #dcdcdc;
}
.hljs-keyword,
.hljs-literal,
.hljs-name,
.hljs-symbol {
  color: #569cd6;
}
.hljs-link {
  color: #569cd6;
  text-decoration: underline;
}
.hljs-built_in,
.hljs-type {
  color: #4ec9b0;
}
.hljs-class,
.hljs-number {
  color: #b8d7a3;
}
.hljs-meta .hljs-string,
.hljs-string {
  color: #d69d85;
}
.hljs-regexp,
.hljs-template-tag {
  color: #9a5334;
}
.hljs-formula,
.hljs-function,
.hljs-params,
.hljs-subst,
.hljs-title {
  color: #dcdcdc;
}
.hljs-comment,
.hljs-quote {
  color: #57a64a;
  font-style: italic;
}
.hljs-doctag {
  color: #608b4e;
}
.hljs-meta,
.hljs-meta .hljs-keyword,
.hljs-tag {
  color: #9b9b9b;
}
.hljs-template-variable,
.hljs-variable {
  color: #bd63c5;
}
.hljs-attr,
.hljs-attribute {
  color: #9cdcfe;
}
.hljs-section {
  color: gold;
}
.hljs-emphasis {
  font-style: italic;
}
.hljs-strong {
  font-weight: 700;
}
.hljs-bullet,
.hljs-selector-attr,
.hljs-selector-class,
.hljs-selector-id,
.hljs-selector-pseudo,
.hljs-selector-tag {
  color: #d7ba7d;
}
.hljs-addition {
  background-color: #144212;
  display: inline-block;
  width: 100%;
}
.hljs-deletion {
  background-color: #600;
  display: inline-block;
  width: 100%;
}

/*! CodeSlide Presets */
a {
  color: dodgerblue;
}
body {
  margin: 0;
  overflow: hidden;
}
code {
  font-size: 85%;
}
html {
  overflow: hidden;
}
img {
  max-width: 100%;
}
li {
  margin-top: 0.25em;
}
p:empty {
  display: none;
}
pre {
  white-space: pre-wrap;
  overflow-wrap: break-word;
}
pre > code {
  display: block;
  padding: 1em;
}
video {
  max-width: 100%;
}
.slide {
  padding: 1em 2em;
}
#slides {
  line-height: 1.5;
}
@media screen {
  .slide {
    min-width: calc(100vw - 4em);
    height: calc(100vh - 2em);
    height: calc(100dvh - 2em);
    overflow-y: scroll;
    scroll-snap-align: start;
    scroll-snap-stop: always;
    scrollbar-width: none;
  }
  .slide::-webkit-scrollbar {
    display: none;
  }
  #slides {
    display: flex;
    flex-direction: row;
    overflow-x: scroll;
    overscroll-behavior: none;
    scroll-behavior: smooth;
    scroll-snap-type: x mandatory;
  }
}
@media print {
  @page {
    margin: 0;
  }
  html {
    print-color-adjust: exact;
    -webkit-print-color-adjust: exact;
  }
  /* h1, h2, h3, h4, h5, h6 {
    break-after: avoid-page;
  } */
  .slide {
    break-after: page;
  }
}

/*! CodeSlide codeFont properties */
code {
  font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
}
pre > code {
  font-size: 1rem;
  font-weight: normal;
}

/* CodeSlide slideFont properties */
#slides {
  font-family: system-ui;
  font-size: 1.5rem;
  font-weight: normal;
}
</style></head>
<body>
<div id="slides">
<div class="slide" id="slide_0">
<h1 id="restful-api-example-nodejs--express--mongodb">RESTful API Example (Node.js + Express + MongoDB)</h1>
<p>The repository is <a href="https://github.com/AsherJingkongChen/NEM-REST-API-Example.git">here</a></p>
</div>
<div class="slide" id="slide_1">
<h1 id="purpose">Purpose</h1>
<p>This example is for learning backend techniques:</p>
<ul>
<li>RESTful API</li>
<li>CRUD operations</li>
</ul>
</div>
<div class="slide" id="slide_2">
<h1 id="features">Features</h1>
<ul>
<li>Uses Node.js for server</li>
<li>Uses Express for router</li>
<li>Uses MongoDB + Mongoose for database</li>
<li>Uses Postman for testing</li>
<li>Uses JavaScript ESModule syntax</li>
</ul>
</div>
<div class="slide" id="slide_3">
<h1 id="usage-demo">Usage demo</h1>
<video autoplay controls loop muted src="https://github.com/AsherJingkongChen/NEM-REST-API-Example/assets/37398747/dcd5559c-0edc-49d1-b847-2080fc8704b9
"></video>
</div>
<div class="slide" id="slide_4">
<h1 id="problems-i-solved">Problems I solved</h1>
<ul>
<li>How to setup tests with Postman?</li>
<li>How to setup routers with Express?</li>
<li>How to build a simple RESTful API example?</li>
<li>How to interact with MongoDB?</li>
</ul>
</div>
<div class="slide" id="slide_5">
<h1 id="processes">Processes</h1>
<ol>
<li>Entry point</li>
<li>A Model</li>
<li>A Router</li>
<li>CRUD Controllers</li>
</ol>
</div>
<div class="slide" id="slide_6">
<h1 id="entry-point">Entry point</h1>
<p><pre><code class="language-js hljs"><span class="hljs-keyword">import</span> mongoose <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CardRouter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./routers/Card/CardRouter.js&#x27;</span>;
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;express&#x27;</span>;
<span class="hljs-keyword">import</span> cors <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;cors&#x27;</span>;
<span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dotenv&#x27;</span>;
<span class="hljs-title function_">config</span>();

<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">API_VERSION</span>, <span class="hljs-variable constant_">HOST</span>, <span class="hljs-variable constant_">PORT</span> } = process.<span class="hljs-property">env</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_ROUTE</span> = <span class="hljs-string">`api/v<span class="hljs-subst">${API_VERSION}</span>`</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DB_URI</span> = process.<span class="hljs-property">env</span>[<span class="hljs-string">`DB_V<span class="hljs-subst">${API_VERSION}</span>_URI`</span>];

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> }));
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());

app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.path}</span>`</span>);
  <span class="hljs-title function_">next</span>();
});

app.<span class="hljs-title function_">use</span>(<span class="hljs-string">`/<span class="hljs-subst">${API_ROUTE}</span>/cards`</span>, <span class="hljs-title class_">CardRouter</span>);

app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server is listening at port <span class="hljs-subst">${PORT}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`API URL: <span class="hljs-subst">${HOST}</span>:<span class="hljs-subst">${PORT}</span>/<span class="hljs-subst">${API_ROUTE}</span>`</span>);

  <span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-variable constant_">DB_URI</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Connected to the MongoDB Atlas Database &quot;<span class="hljs-subst">${
    mongoose.connection.name
  }</span>&quot;`</span>);
});</code></pre></p>
</div>
<div class="slide" id="slide_7">
<h1 id="a-model">A model</h1>
<p><pre><code class="language-js hljs"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Schema</span>, model } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;

<span class="hljs-keyword">const</span> data = {
  <span class="hljs-attr">author</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;Nobody&#x27;</span>, <span class="hljs-attr">maxlength</span>: <span class="hljs-number">64</span> },
  <span class="hljs-attr">title</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;Nothing&#x27;</span>, <span class="hljs-attr">maxLength</span>: <span class="hljs-number">256</span> },
  <span class="hljs-attr">content</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">maxLength</span>: <span class="hljs-number">64</span> * <span class="hljs-number">256</span> },
};

<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(data, {
  <span class="hljs-attr">collection</span>: <span class="hljs-string">&#x27;Card&#x27;</span>,
  <span class="hljs-attr">timestamps</span>: <span class="hljs-literal">true</span>,

  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">log</span>(<span class="hljs-params"></span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.title}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.author}</span>): `</span> + 
             <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.content.slice(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>)}</span> (...)`</span>;
    },
  },
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">CardModel</span> = <span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Card&#x27;</span>, schema);</code></pre></p>
</div>
<div class="slide" id="slide_8">
<h1 id="a-router">A router</h1>
<p><pre><code class="language-js hljs"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Router</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;express&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CardController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../controllers/Card/CardController.js&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">CardRouter</span> = <span class="hljs-title class_">Router</span>()
  .<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-title class_">CardController</span>.<span class="hljs-property">createOne</span>)
  .<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-title class_">CardController</span>.<span class="hljs-property">readAll</span>)
  .<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/:id&#x27;</span>, <span class="hljs-title class_">CardController</span>.<span class="hljs-property">readOne</span>)
  .<span class="hljs-title function_">patch</span>(<span class="hljs-string">&#x27;/:id&#x27;</span>, <span class="hljs-title class_">CardController</span>.<span class="hljs-property">updateOne</span>)
  .<span class="hljs-title function_">delete</span>(<span class="hljs-string">&#x27;/:id&#x27;</span>, <span class="hljs-title class_">CardController</span>.<span class="hljs-property">deleteOne</span>);</code></pre></p>
</div>
<div class="slide" id="slide_9">
<h1 id="crud-controllers">CRUD controllers</h1>
<ul>
<li>Create</li>
<li>Read</li>
<li>Update</li>
<li>Delete</li>
</ul>
</div>
<div class="slide" id="slide_10">
<h1 id="create">Create</h1>
<p><pre><code class="language-js hljs"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CardModel</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../models/Card/CardModel.js&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StatusCodes</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;http-status-codes&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SuccessForm</span>, <span class="hljs-title class_">ErrorForm</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./ResponseForm.js&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createOne</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">var</span> card = <span class="hljs-keyword">await</span> <span class="hljs-title class_">CardModel</span>.<span class="hljs-title function_">create</span>(req.<span class="hljs-property">body</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> res
      .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">BAD_REQUEST</span>)
      .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">ErrorForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">BAD_REQUEST</span>, error));
  }

  <span class="hljs-keyword">return</span> res
    .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">CREATED</span>)
    .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">SuccessForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">CREATED</span>, card));
};</code></pre></p>
</div>
<div class="slide" id="slide_11">
<h1 id="read">Read</h1>
<p><pre><code class="language-js hljs"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CardModel</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../models/Card/CardModel.js&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StatusCodes</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;http-status-codes&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Types</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;
<span class="hljs-keyword">import</span> { 
  <span class="hljs-title class_">SuccessForm</span>, 
  <span class="hljs-title class_">ErrorForm</span>, 
  <span class="hljs-title class_">IndexError</span>, 
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./ResponseForm.js&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readAll</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">const</span> cards = <span class="hljs-keyword">await</span> <span class="hljs-title class_">CardModel</span>
    .<span class="hljs-title function_">find</span>({})
    .<span class="hljs-title function_">sort</span>({ <span class="hljs-attr">createAt</span>: <span class="hljs-string">&#x27;descending&#x27;</span> });
  
  <span class="hljs-keyword">return</span> res
    .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">OK</span>)
    .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">SuccessForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">OK</span>, cards));
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readOne</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">const</span> { id } = req.<span class="hljs-property">params</span>;
  <span class="hljs-keyword">if</span> (! <span class="hljs-title class_">Types</span>.<span class="hljs-property">ObjectId</span>.<span class="hljs-title function_">isValid</span>(id)) {
    <span class="hljs-keyword">return</span> res
      .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>)
      .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">ErrorForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>, <span class="hljs-title class_">IndexError</span>(id)));
  }

  <span class="hljs-keyword">const</span> card = <span class="hljs-keyword">await</span> <span class="hljs-title class_">CardModel</span>.<span class="hljs-title function_">findById</span>(id);
  <span class="hljs-keyword">if</span> (! card) {
    <span class="hljs-keyword">return</span> res
      .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>)
      .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">ErrorForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>, <span class="hljs-title class_">IndexError</span>(id)));
  }

  <span class="hljs-keyword">return</span> res
    .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">OK</span>)
    .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">SuccessForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">OK</span>, card));
};</code></pre></p>
</div>
<div class="slide" id="slide_12">
<h1 id="update">Update</h1>
<p><pre><code class="language-js hljs"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CardModel</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../models/Card/CardModel.js&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StatusCodes</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;http-status-codes&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Types</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;
<span class="hljs-keyword">import</span> { 
  <span class="hljs-title class_">SuccessForm</span>, 
  <span class="hljs-title class_">ErrorForm</span>, 
  <span class="hljs-title class_">IndexError</span>, 
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./ResponseForm.js&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateOne</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">const</span> { id } = req.<span class="hljs-property">params</span>;  
  <span class="hljs-keyword">if</span> (! <span class="hljs-title class_">Types</span>.<span class="hljs-property">ObjectId</span>.<span class="hljs-title function_">isValid</span>(id)) {
    <span class="hljs-keyword">return</span> res
      .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>)
      .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">ErrorForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>, <span class="hljs-title class_">IndexError</span>(id)));
  }

  <span class="hljs-keyword">const</span> { author, title, content } = req.<span class="hljs-property">body</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">var</span> card = <span class="hljs-keyword">await</span> <span class="hljs-title class_">CardModel</span>.<span class="hljs-title function_">findByIdAndUpdate</span>(id, 
      { author, title, content }, 
      { 
        <span class="hljs-attr">new</span>: <span class="hljs-literal">true</span>, 
        <span class="hljs-attr">runValidators</span>: <span class="hljs-literal">true</span>,
      });
    
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> res
      .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">BAD_REQUEST</span>)
      .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">ErrorForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">BAD_REQUEST</span>, error));
  }
  
  <span class="hljs-keyword">if</span> (! card) {
    <span class="hljs-keyword">return</span> res
      .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>)
      .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">ErrorForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>, <span class="hljs-title class_">IndexError</span>(id)));
  }
  
  <span class="hljs-keyword">return</span> res
    .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">OK</span>)
    .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">SuccessForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">OK</span>, card));
};</code></pre></p>
</div>
<div class="slide" id="slide_13">
<h1 id="delete">Delete</h1>
<p><pre><code class="language-js hljs"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CardModel</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../models/Card/CardModel.js&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StatusCodes</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;http-status-codes&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Types</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mongoose&#x27;</span>;
<span class="hljs-keyword">import</span> { 
  <span class="hljs-title class_">SuccessForm</span>, 
  <span class="hljs-title class_">ErrorForm</span>, 
  <span class="hljs-title class_">IndexError</span>, 
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./ResponseForm.js&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteOne</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">const</span> { id } = req.<span class="hljs-property">params</span>;
  <span class="hljs-keyword">if</span> (! <span class="hljs-title class_">Types</span>.<span class="hljs-property">ObjectId</span>.<span class="hljs-title function_">isValid</span>(id)) {
    <span class="hljs-keyword">return</span> res
      .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>)
      .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">ErrorForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>, <span class="hljs-title class_">IndexError</span>(id)));
  }

  <span class="hljs-keyword">const</span> card = <span class="hljs-keyword">await</span> <span class="hljs-title class_">CardModel</span>.<span class="hljs-title function_">findByIdAndDelete</span>(id);
  <span class="hljs-keyword">if</span> (! card) {
    <span class="hljs-keyword">return</span> res
      .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>)
      .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">ErrorForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">NOT_FOUND</span>, <span class="hljs-title class_">IndexError</span>(id)));
  }

  <span class="hljs-keyword">return</span> res
    .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">OK</span>)
    .<span class="hljs-title function_">json</span>(<span class="hljs-title class_">SuccessForm</span>(<span class="hljs-title class_">StatusCodes</span>.<span class="hljs-property">OK</span>, card));
};</code></pre></p>
</div>
<div class="slide" id="slide_14">
<h1 id="utilities">Utilities</h1>
<h2 id="responseform">ResponseForm</h2>
<p><pre><code class="language-js hljs"><span class="hljs-keyword">import</span> { getReasonPhrase } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;http-status-codes&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">SuccessForm</span> = (<span class="hljs-params">statusCode, card</span>) =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">code</span>: statusCode,
    <span class="hljs-attr">status</span>: <span class="hljs-title function_">getReasonPhrase</span>(statusCode),
    <span class="hljs-attr">response</span>: card,
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">ErrorForm</span> = (<span class="hljs-params">statusCode, error</span>) =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">code</span>: statusCode,
    <span class="hljs-attr">status</span>: <span class="hljs-title function_">getReasonPhrase</span>(statusCode),
    <span class="hljs-attr">response</span>: {
      <span class="hljs-attr">errorName</span>: error.<span class="hljs-property">name</span>,
      <span class="hljs-attr">errorInfo</span>: error.<span class="hljs-property">message</span>,
    },
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">IndexError</span> = (<span class="hljs-params">id</span>) =&gt; { 
  <span class="hljs-keyword">return</span> { 
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;IndexError&#x27;</span>, 
    <span class="hljs-attr">message</span>: <span class="hljs-string">`There&#x27;s no such card with id <span class="hljs-subst">${id}</span>`</span>,
  }
};</code></pre></p>
</div>
<div class="slide" id="slide_15">
<h1 id="thanks-for-your-watching">Thanks for your watching!</h1>
<p>The repository is <a href="https://github.com/AsherJingkongChen/NEM-REST-API-Example.git">here</a>
The tests are on <a href="https://www.postman.com/supply-administrator-56584646/workspace/my-workspace/collection/24393116-46ba2a8d-f6c5-409f-9ee9-c1b1fd0eba0d?action=share&creator=24393116">Postman</a></p>
</div>
</div></body>
</html>
